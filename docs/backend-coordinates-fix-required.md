# ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏ô Backend ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á

## üéØ **‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö:**
- **Backend ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏õ‡∏•‡∏≠‡∏°** `lng: "99.99999999"` ‡πÅ‡∏ó‡∏ô‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á
- **Frontend ‡∏™‡πà‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á** ‡πÅ‡∏ï‡πà backend ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ
- **‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç backend** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å frontend

---

## üîß **‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏ô Backend:**

### **1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö API Endpoints ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á:**

#### **A. POST /api/measurements**
**‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö:**
```json
// ‚ùå Response ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å backend
{
  "message": "Measurement saved",
  "measurement": {
    "measurementid": 141,
    "deviceid": 26,
    "lng": "99.99999999",  // ‚ùå ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏õ‡∏•‡∏≠‡∏°
    "lat": "16.24675200",  // ‚ùå ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏õ‡∏•‡∏≠‡∏°
    "areasid": null
  }
}
```

**‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:**
```javascript
// ‚úÖ ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ backend ‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å frontend ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
const { lat, lng, deviceId, temperature, moisture, ph, phosphorus, potassium, nitrogen, measurementPoint, areaId } = req.body;

// ‚úÖ ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å frontend
const measurementData = {
  deviceid: deviceId,
  measurement_date: measurementDate,
  measurement_time: measurementTime,
  temperature: temperature,
  moisture: moisture,
  ph: ph,
  phosphorus: phosphorus,
  potassium_avg: potassium,
  nitrogen: nitrogen,
  lng: lng,  // ‚úÖ ‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å frontend
  lat: lat,  // ‚úÖ ‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å frontend
  areasid: areaId,
  is_epoch: false,
  is_uptime: false
};
```

#### **B. POST /api/measurements/single-point**
**‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö:**
- ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏õ‡∏•‡∏≠‡∏°‡πÅ‡∏ó‡∏ô‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á

**‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:**
```javascript
// ‚úÖ ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å frontend
const { lat, lng, deviceId, temperature, moisture, ph, phosphorus, potassium, nitrogen, measurementPoint, areaId } = req.body;

// ‚úÖ ‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏•‡∏á database
const query = `
  INSERT INTO measurement (deviceid, measurement_date, measurement_time, temperature, moisture, ph, phosphorus, potassium_avg, nitrogen, lng, lat, areasid, is_epoch, is_uptime, created_at)
  VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, NOW())
`;
const values = [
  deviceId,
  measurementDate,
  measurementTime,
  temperature,
  moisture,
  ph,
  phosphorus,
  potassium,
  nitrogen,
  lng,  // ‚úÖ ‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å frontend
  lat,  // ‚úÖ ‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å frontend
  areaId,
  false,
  false
];
```

#### **C. POST /api/measurements/create-area**
**‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö:**
- ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏õ‡∏•‡∏≠‡∏°‡πÅ‡∏ó‡∏ô‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á

**‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:**
```javascript
// ‚úÖ ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å frontend
measurements.forEach((measurement, index) => {
  const { lat, lng, temperature, moisture, ph, phosphorus, potassium, nitrogen } = measurement;
  
  // ‚úÖ ‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏•‡∏á database
  const query = `
    INSERT INTO measurement (deviceid, measurement_date, measurement_time, temperature, moisture, ph, phosphorus, potassium_avg, nitrogen, lng, lat, areasid, is_epoch, is_uptime, created_at)
    VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, NOW())
  `;
  const values = [
    deviceId,
    measurementDate,
    measurementTime,
    temperature,
    moisture,
    ph,
    phosphorus,
    potassium,
    nitrogen,
    lng,  // ‚úÖ ‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å frontend
    lat,  // ‚úÖ ‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å frontend
    areaId,
    false,
    false
  ];
});
```

### **2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Database Schema:**

#### **A. ‡∏ï‡∏≤‡∏£‡∏≤‡∏á measurement**
**‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤:**
- Column `lng` ‡πÅ‡∏•‡∏∞ `lat` ‡∏°‡∏µ precision ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
- ‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ `DECIMAL(10,8)` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö lat ‡πÅ‡∏•‡∏∞ `DECIMAL(11,8)` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö lng

```sql
-- ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö schema ‡∏Ç‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á measurement
SELECT column_name, data_type, numeric_precision, numeric_scale 
FROM information_schema.columns 
WHERE table_name = 'measurement' 
AND column_name IN ('lat', 'lng');

-- ‚úÖ ‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç schema
ALTER TABLE measurement 
ALTER COLUMN lat TYPE DECIMAL(10,8),
ALTER COLUMN lng TYPE DECIMAL(11,8);
```

### **3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:**

#### **A. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö roundLatLng function**
**‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö:**
- Backend ‡∏≠‡∏≤‡∏à‡∏°‡∏µ function `roundLatLng` ‡∏ó‡∏µ‡πà‡πÅ‡∏õ‡∏•‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏õ‡∏•‡∏≠‡∏°

**‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:**
```javascript
// ‚ùå ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ function ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô backend ‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏ö‡∏≠‡∏≠‡∏Å
const roundLatLng = (value, decimals = 6) => {
  if (value === null || value === undefined) return null;
  const rounded = Math.round(value * Math.pow(10, decimals)) / Math.pow(10, decimals);
  return rounded.toFixed(decimals);
};

// ‚úÖ ‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å frontend ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
const lat = parseFloat(req.body.lat);
const lng = parseFloat(req.body.lng);
```

### **4. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏±‡∏ö:**

#### **A. Response Format**
**‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö:**
- Response ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏™‡πà‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏õ‡∏•‡∏≠‡∏°‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ

**‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:**
```javascript
// ‚úÖ ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ
res.json({
  message: "Measurement saved",
  measurement: {
    measurementid: result.rows[0].measurementid,
    deviceid: deviceId,
    measurement_date: measurementDate,
    measurement_time: measurementTime,
    temperature: temperature,
    moisture: moisture,
    ph: ph,
    phosphorus: phosphorus,
    potassium_avg: potassium,
    nitrogen: nitrogen,
    lng: lng,  // ‚úÖ ‡∏™‡πà‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ
    lat: lat,  // ‚úÖ ‡∏™‡πà‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ
    areasid: areaId,
    is_epoch: false,
    is_uptime: false,
    created_at: new Date().toISOString()
  }
});
```

---

## üß™ **‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥:**

### **1. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö API Endpoints:**
```bash
# ‡∏ó‡∏î‡∏™‡∏≠‡∏ö POST /api/measurements
curl -X POST http://localhost:3000/api/measurements \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "deviceId": "26",
    "temperature": 25.5,
    "moisture": 65.2,
    "ph": 6.8,
    "phosphorus": 12.4,
    "potassium": 18.6,
    "nitrogen": 15.7,
    "lat": 16.2464504,
    "lng": 103.2501379,
    "measurementPoint": 1,
    "areaId": 58
  }'
```

### **2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Response:**
```json
// ‚úÖ Response ‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á
{
  "message": "Measurement saved",
  "measurement": {
    "measurementid": 141,
    "deviceid": 26,
    "lng": "103.2501379",  // ‚úÖ ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á
    "lat": "16.2464504",   // ‚úÖ ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á
    "areasid": 58
  }
}
```

### **3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Database:**
```sql
-- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô database
SELECT measurementid, lng, lat, areasid, created_at 
FROM measurement 
WHERE areasid = 58 
ORDER BY created_at DESC 
LIMIT 5;
```

---

## üéØ **‡∏™‡∏£‡∏∏‡∏õ:**

**‚úÖ ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏ô Backend:**

1. **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö API Endpoints** ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î
2. **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á** ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å frontend
3. **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Database Schema** ‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö precision ‡∏™‡∏π‡∏á
4. **‡∏•‡∏ö function ‡∏ó‡∏µ‡πà‡πÅ‡∏õ‡∏•‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏õ‡∏•‡∏≠‡∏°**
5. **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Response Format** ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ
6. **‡∏ó‡∏î‡∏™‡∏≠‡∏ö API Endpoints** ‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

**üéØ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢:**
- **Backend ‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á** ‡∏à‡∏≤‡∏Å frontend
- **‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á** ‡∏•‡∏á‡πÉ‡∏ô database
- **‡∏™‡πà‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á** ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á frontend
- **‡∏´‡∏ô‡πâ‡∏≤ History ‡πÅ‡∏™‡∏î‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á** ‡∏à‡∏≤‡∏Å database

**üöÄ ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß:**
- **Frontend ‡∏™‡πà‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á** ‚Üí **Backend ‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á** ‚Üí **Database ‡πÄ‡∏Å‡πá‡∏ö‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á** ‚Üí **‡∏´‡∏ô‡πâ‡∏≤ History ‡πÅ‡∏™‡∏î‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á**
