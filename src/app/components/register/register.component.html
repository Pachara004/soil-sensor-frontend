<div class="container">
  <div class="card">
    <!-- ปุ่มย้อนกลับ -->
    <div class="back" (click)="goBack()">
      <i class="fas fa-arrow-left"></i>
    </div>

    <!-- โลโก้ -->
    <div class="logo">
      <img src="https://cdn-icons-png.freepik.com/512/1345/1345362.png" alt="App Logo">
    </div>

    <!-- Progress Bar -->
    <div class="progress-container">
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="(step / 4) * 100"></div>
      </div>
      <div class="progress-text">ขั้นตอนที่ {{ step }} จาก 4</div>
    </div>

    <!-- Step 1: กรอก Email -->
    <div *ngIf="step === 1" class="step-container">
      <h3>ใส่อีเมลของคุณ</h3>
      <label>Email</label>
      <input type="email" [(ngModel)]="email" placeholder="Enter your email" (blur)="checkEmailAvailability()"
        required />
      <div class="email-status" *ngIf="emailStatus">
        <span [class]="emailStatus.class">{{ emailStatus.message }}</span>
      </div>
      <button class="primary-btn" (click)="sendOtp()"
        [disabled]="isLoading || isCheckingEmail || emailStatus?.class === 'error'">
        <span *ngIf="!isLoading && !isCheckingEmail">ส่ง OTP</span>
        <span *ngIf="isLoading">กำลังส่ง...</span>
        <span *ngIf="isCheckingEmail">กำลังตรวจสอบ...</span>
      </button>
    </div>

    <!-- Step 2: กรอก OTP -->
    <div *ngIf="step === 2" class="step-container">
      <h3>ยืนยัน OTP</h3>
      <p class="step-description">กรุณาใส่รหัส OTP ที่ส่งไปยัง {{ email }}</p>
      <div class="reference-info" *ngIf="otpReferenceNumber">
        <p class="reference-text">เลขอ้างอิง: <strong>{{ otpReferenceNumber }}</strong></p>
      </div>
      <div class="otp-boxes">
        <input *ngFor="let box of otpInputsArray; let i = index" maxlength="1" [(ngModel)]="otp[i]"
          (input)="moveToNext($event, i)" (keydown)="onKeyDown($event, i)" #otpInput />
      </div>
      <div class="resend-container">
        <span *ngIf="countdown > 0">ส่งใหม่ได้ในอีก {{ countdown }} วินาที</span>
        <button *ngIf="countdown === 0" class="link-btn" (click)="resendOtp()">ส่ง OTP ใหม่</button>
      </div>
      <button class="primary-btn" (click)="verifyOtp()" [disabled]="isLoading">
        <span *ngIf="!isLoading">ยืนยัน OTP</span>
        <span *ngIf="isLoading">กำลังตรวจสอบ...</span>
      </button>
    </div>

    <!-- Step 3: กรอกรหัสผ่าน -->
    <div *ngIf="step === 3" class="step-container">
      <h3>สร้างรหัสผ่าน</h3>
      <label>รหัสผ่าน</label>
      <div class="password-container">
        <input [type]="showPassword ? 'text' : 'password'" [(ngModel)]="password" placeholder="อย่างน้อย 6 ตัวอักษร" />
        <i class="password-toggle fas" [class.fa-eye]="!showPassword" [class.fa-eye-slash]="showPassword"
          (click)="togglePassword()"></i>
      </div>

      <label>ยืนยันรหัสผ่าน</label>
      <div class="password-container">
        <input [type]="showConfirmPassword ? 'text' : 'password'" [(ngModel)]="confirmPassword"
          placeholder="ยืนยันรหัสผ่าน" />
        <i class="password-toggle fas" [class.fa-eye]="!showConfirmPassword" [class.fa-eye-slash]="showConfirmPassword"
          (click)="toggleConfirmPassword()"></i>
      </div>

      <div class="error" *ngIf="passwordMismatch">
        รหัสผ่านไม่ตรงกัน
      </div>

      <div class="password-strength" *ngIf="password">
        <div class="strength-bar">
          <div class="strength-fill" [class]="passwordStrength.class" [style.width.%]="passwordStrength.width"></div>
        </div>
        <span [class]="passwordStrength.class">{{ passwordStrength.text }}</span>
      </div>

      <button class="primary-btn" (click)="nextToPersonalInfo()">ถัดไป</button>
    </div>

    <!-- Step 4: กรอกข้อมูลส่วนตัว -->
    <div *ngIf="step === 4" class="step-container">
      <h3>ข้อมูลส่วนตัว</h3>
      <label>ชื่อผู้ใช้ (Username)</label>
      <input type="text" [(ngModel)]="username" placeholder="ชื่อผู้ใช้ที่ไม่ซ้ำใคร"
        (blur)="checkUsernameAvailability()" />
      <div class="username-status" *ngIf="usernameStatus">
        <span [class]="usernameStatus.class">{{ usernameStatus.message }}</span>
      </div>

      <label>ชื่อ-นามสกุล</label>
      <input type="text" [(ngModel)]="fullName" placeholder="ชื่อ-นามสกุล" />

      <label>เบอร์โทรศัพท์</label>
      <input type="tel" [(ngModel)]="phoneNumber" placeholder="08X-XXX-XXXX" (input)="formatPhoneNumber($event)" />

      <button class="primary-btn" (click)="register()" [disabled]="isRegistering">
        <span *ngIf="!isRegistering">สมัครสมาชิก</span>
        <span *ngIf="isRegistering">กำลังสมัคร...</span>
      </button>
    </div>

    <!-- Google Sign In -->
    <div class="divider">
      <span>หรือ</span>
    </div>
    <button class="google-btn" (click)="registerWithGoogle()">
      <img src="https://img.icons8.com/color/48/google-logo.png" width="20" />
      Register With Google
    </button>
  </div>
</div>