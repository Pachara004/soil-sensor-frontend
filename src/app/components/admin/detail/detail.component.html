<div class="device-detail-container">
  <div class="device-detail-card">
    <button class="back-btn" (click)="goBack()">
      <i class="fas fa-arrow-left"></i>
      ย้อนกลับ
    </button>

    <div class="device-info">
      <h2>
        <i class="fas fa-microchip"></i>
        ข้อมูลอุปกรณ์
      </h2>

      <div class="device-details">
        <div class="detail-row">
          <div class="detail-label">
            <i class="fas fa-tag"></i>
            <span>ชื่ออุปกรณ์:</span>
          </div>
          <div class="detail-value device-name-value">{{ device?.device_name || device?.name || 'ไม่ระบุ' }}</div>
        </div>

        <div class="detail-row">
          <div class="detail-label">
            <i class="fas fa-id-badge"></i>
            <span>Device ID:</span>
          </div>
          <div class="detail-value device-id-value">{{ device?.deviceid || device?.id || 'ไม่ระบุ' }}</div>
        </div>

        <div class="detail-row">
          <div class="detail-label">
            <i class="fas fa-user"></i>
            <span>ผู้ใช้:</span>
          </div>
          <div class="detail-value user-name-value">{{ device?.user_name || device?.user || 'ไม่ระบุ' }}</div>
        </div>

        <div class="detail-row">
          <div class="detail-label">
            <i class="fas fa-id-card"></i>
            <span>User ID:</span>
          </div>
          <div class="detail-value user-id-value">{{ device?.userid || 'ไม่ระบุ' }}</div>
        </div>

        <div class="detail-row">
          <div class="detail-label">
            <i class="fas fa-power-off"></i>
            <span>สถานะ:</span>
          </div>
          <div class="detail-value">
            <span [class]="'status-' + (device?.status || 'offline')">
              {{ device?.status === 'online' ? 'ออนไลน์' : 'ออฟไลน์' }}
            </span>
          </div>
        </div>

        <div class="detail-row" *ngIf="device?.device_type !== undefined">
          <div class="detail-label">
            <i class="fas fa-cog"></i>
            <span>ประเภท:</span>
          </div>
          <div class="detail-value">
            <span [class]="'type-' + (device?.device_type ? 'production' : 'test')">
              {{ device?.device_type ? 'อุปกรณ์จริง' : 'อุปกรณ์ทดสอบ' }}
            </span>
          </div>
        </div>

        <div class="detail-row" *ngIf="device?.description">
          <div class="detail-label">
            <i class="fas fa-info-circle"></i>
            <span>คำอธิบาย:</span>
          </div>
          <div class="detail-value">{{ device?.description }}</div>
        </div>

        <div class="detail-row" *ngIf="device?.created_at">
          <div class="detail-label">
            <i class="fas fa-calendar-plus"></i>
            <span>สร้างเมื่อ:</span>
          </div>
          <div class="detail-value">{{ formatDate(device?.created_at) }}</div>
        </div>

        <div class="detail-row" *ngIf="device?.updated_at">
          <div class="detail-label">
            <i class="fas fa-calendar-check"></i>
            <span>อัปเดตล่าสุด:</span>
          </div>
          <div class="detail-value">{{ formatDate(device?.updated_at) }}</div>
        </div>
      </div>
    </div>

    <div class="measurements-section">
      <h3>ประวัติการวัด</h3>
      <div *ngIf="isLoading" class="loading-container">
        <mat-spinner diameter="40"></mat-spinner>
        <span style="margin-left: 10px;">กำลังโหลดข้อมูล...</span>
      </div>
      <div *ngIf="!isLoading && measurements.length === 0" class="no-data">
        <p>ไม่พบข้อมูลการวัด</p>
      </div>
      <div *ngIf="!isLoading && measurements.length > 0" class="measurement-list">
        <div *ngFor="let measurement of measurements" class="measurement-item">
          <div class="measurement-info">
            <p class="measurement-point">จุดที่: {{ measurement.measurementPoint || 'ไม่ระบุ' }}</p>
            <p>วันที่: {{ measurement.date }}</p>
            <p>พิกัด: {{ measurement.lat || 'ไม่ระบุ' }}, {{ measurement.lng || 'ไม่ระบุ' }}</p>
          </div>
          <button class="view-btn" (click)="showMeasurementPopup(measurement)">ดูรายละเอียด</button>
        </div>
      </div>
    </div>

    <div class="map-section">
      <h3>แผนที่จุดวัด</h3>
      <div id="mapContainer"></div>
      <p style="margin-top: 10px; font-size: 14px; color: #666;">คลิกที่จุดสีแดงเพื่อดูรายละเอียดการวัด</p>
    </div>
  </div>
</div>