<div class="admin-container">
  <button class="logout-btn" (click)="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>

  <div class="card">
    <div class="top-right-icons">
      <div class="icon-box" (click)="goToUsers()">
        <img src="https://www.iconpacks.net/icons/2/free-user-icon-3296-thumb.png" alt="Users">
          <div class="text">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</div>
      </div>

      <div class="icon-box" (click)="goToReports()">
        <img src="https://cdn-icons-png.flaticon.com/512/565/565340.png" alt="Messages">
        <div class="text">
          ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
          <span class="unread-count" *ngIf="unreadCount > 0">{{ unreadCount > 99 ? '99+' : unreadCount }}</span>
        </div>
      </div>
    </div>

    <img src="https://cdn.iconscout.com/icon/premium/png-256-thumb/soil-sensor-4449978-3688706.png" alt="Soil Sensor" class="chip-icon">
    <div class="admin-name">Admin : {{ adminName }}</div>

    <div class="user-stats-section">
      <div class="stats-box">
        <span class="stats-icon">üë•</span>
        <div class="stats-content">
          <div class="stats-number">{{ totalUsers }}</div>
          <div class="stats-label">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</div>
        </div>
        <button class="view-all-users-btn" (click)="toggleUsersList()">
          {{ showUsersList ? '‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£' : '‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' }}
        </button>
      </div>
    </div>

    <div class="users-section" *ngIf="showUsersList">
      <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
      <div class="users-list">
        <div class="user-item" *ngFor="let user of allUsersDisplay">
          <div class="user-info">
            <div class="user-name">{{ user.username }}</div>
            <div class="user-email">‡∏≠‡∏µ‡πÄ‡∏°‡∏•: {{ user.email }}</div>
            <div class="user-type">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: {{ user.type || 'user' }}</div>
            <div class="user-created">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: {{ formatDate(user.createdAt) }}</div>
          </div>
          <div class="user-actions">
            <button class="edit-btn" (click)="editUser(user)">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
            <button class="delete-user-btn" (click)="deleteUser(user.username)">‡∏•‡∏ö</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-overlay" *ngIf="showEditModal">
      <div class="edit-modal">
        <div class="modal-header">
          <h3>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
          <button class="close-btn" (click)="closeEditModal()">√ó</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:</label>
            <input type="text" [(ngModel)]="editingUser.username" readonly>
          </div>
          <div class="form-group">
            <label>‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</label>
            <input type="email" [(ngModel)]="editingUser.email">
          </div>
          <div class="form-group">
            <label>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà (‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô):</label>
            <input type="password" [(ngModel)]="newPassword">
          </div>
          <div class="form-group">
            <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:</label>
            <select [(ngModel)]="editingUser.type">
              <option value="user">User</option>
              <option value="admin">Admin</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button class="save-btn" (click)="saveUserChanges()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          <button class="cancel-btn" (click)="closeEditModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>
      </div>
    </div>

    <div class="device-stats-section">
      <div class="stats-box device-stats">
        <span class="stats-icon">üì±</span>
        <div class="stats-content">
          <div class="stats-number">{{ devices.length }}</div>
          <div class="stats-label">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</div>
        </div>
        <button class="view-all-devices-btn" (click)="toggleDevicesList()">
          {{ showDevicesList ? '‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£' : '‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' }}
        </button>
      </div>
    </div>

    <!-- üî• NEW: ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‚Äú‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ú‡∏π‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‚Äù (‡∏à‡∏≤‡∏Å devices/{id}/claim) -->
    <div class="device-section" *ngIf="pendingClaims.length > 0">
      <h3>‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ú‡∏π‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</h3>
      <div class="device-list">
        <div class="device-item" *ngFor="let c of pendingClaims">
          <div class="device-info">
            <div class="device-name">Device ID: {{ c.deviceId }}</div>
            <div class="device-user">‡∏ú‡∏π‡πâ‡∏Ç‡∏≠: {{ c.username }}</div>
            <div class="device-time">‡πÄ‡∏ß‡∏•‡∏≤: {{ c.ts | date:'short' }}</div>
          </div>
          <div class="device-actions">
            <button class="view-btn" (click)="approveClaim(c.deviceId)">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
            <button class="delete-btn" (click)="rejectClaim(c.deviceId)">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</button>
          </div>
        </div>
      </div>
    </div>
    <!-- /NEW -->

    <div class="device-section" *ngIf="showDevicesList">
      <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
      <div class="device-list">
        <div class="device-item" *ngFor="let device of devices">
          <div class="device-info">
            <div class="device-name">{{ device.name }}</div>
            <div class="device-user">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: {{ device.user }}</div>
          </div>
          <div class="device-actions">
            <button class="view-btn" (click)="viewDevice(device)">‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            <button class="delete-btn" (click)="deleteDevice(device.name)">‡∏•‡∏ö</button>
          </div>
        </div>
      </div>
    </div>

    <div class="device-section">
      <div class="add-device-form">
        <div class="form-header">
          <h4>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏´‡∏°‡πà</h4>
        </div>
        <div class="form-inputs">
          <input type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå" [(ngModel)]="newDeviceName">
          <div class="user-input-box">
            <input type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" [(ngModel)]="newDeviceUser" (input)="onUserInput()">
            <ul class="suggest-list" *ngIf="filteredUsers.length > 0">
              <li *ngFor="let u of filteredUsers" (click)="selectUser(u.username)">
                {{ u.username }}
              </li>
            </ul>
          </div>
          <button class="save-btn" (click)="addDevice()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</button>
        </div>
      </div>
    </div>
  </div>
</div>
