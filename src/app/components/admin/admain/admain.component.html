<div class="admin-container">
  <!-- Header -->
  <div class="header">
    <div class="logo">
      <i class="fas fa-seedling"></i>
      <span>Admin Panel</span>
    </div>
    <button class="logout-btn" (click)="logout()">
      <i class="fas fa-sign-out-alt"></i>
      ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
    </button>
  </div>

  <!-- Admin Info -->
  <div class="admin-info">
    <div class="admin-logo">
      <img src="https://cdn.iconscout.com/icon/premium/png-256-thumb/soil-sensor-4449978-3688706.png" alt="Soil Sensor" class="chip-icon">
      <div class="admin-title">Admin Panel</div>
    </div>
    <div class="admin-name">Admin : {{ adminName }}</div>
  </div>

  <!-- Quick Actions -->
  <div class="quick-actions">
    <div class="action-btn" (click)="goToUsers()">
      <img src="https://www.iconpacks.net/icons/2/free-user-icon-3296-thumb.png" alt="Users">
      <div class="text">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</div>
    </div>

    <div class="action-btn" (click)="goToReports()">
      <img src="https://cdn-icons-png.flaticon.com/512/565/565340.png" alt="Messages">
      <div class="text">
        ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
        <span class="unread-count" *ngIf="unreadCount > 0">{{ unreadCount > 99 ? '99+' : unreadCount }}</span>
      </div>
    </div>
  </div>

  <!-- Stats Section -->
  <div class="stats-section">
    <div class="stats-card">
      <div class="stats-header">
        <span class="stats-icon">üë•</span>
        <div class="stats-title">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
      </div>
      <div class="stats-content">
        <div class="stats-number">{{ totalUsers }}</div>
        <div class="stats-label">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</div>
      </div>
      <div class="stats-action">
        <button class="view-all-btn" (click)="toggleUsersList()">
          {{ showUsersList ? '‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£' : '‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' }}
        </button>
      </div>
    </div>

    <div class="stats-card">
      <div class="stats-header">
        <span class="stats-icon">üì±</span>
        <div class="stats-title">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
      </div>
      <div class="stats-content">
        <div class="stats-number">{{ devices.length }}</div>
        <div class="stats-label">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</div>
      </div>
      <div class="stats-action">
        <button class="view-all-btn" (click)="toggleDevicesList()">
          {{ showDevicesList ? '‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£' : '‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Users Section -->
  <div class="content-section" *ngIf="showUsersList">
    <div class="section-header">
      <i class="fas fa-users"></i>
      <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
    </div>
    <div class="content-list">
      <div class="list-item" *ngFor="let user of allUsersDisplay">
        <div class="item-info">
          <div class="item-name">{{ user.username }}</div>
          <div class="item-detail">‡∏≠‡∏µ‡πÄ‡∏°‡∏•: {{ user.email }}</div>
          <div class="item-detail highlight">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: {{ user.type || 'user' }}</div>
          <div class="item-detail">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: {{ formatDate(user.createdAt) }}</div>
        </div>
        <div class="item-actions">
          <button class="btn btn-edit" (click)="editUser(user)">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
          <button class="btn btn-delete" (click)="deleteUser(user.username)">‡∏•‡∏ö</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Modal -->
  <div class="modal-overlay" *ngIf="showEditModal">
    <div class="modal">
      <div class="modal-header">
        <h3>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
        <button class="close-btn" (click)="closeEditModal()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:</label>
          <input type="text" [(ngModel)]="editingUser.username" readonly>
        </div>
        <div class="form-group">
          <label>‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</label>
          <input type="email" [(ngModel)]="editingUser.email">
        </div>
        <div class="form-group">
          <label>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà (‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô):</label>
          <input type="password" [(ngModel)]="newPassword">
        </div>
        <div class="form-group">
          <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:</label>
          <select [(ngModel)]="editingUser.type">
            <option value="user">User</option>
            <option value="admin">Admin</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="save-btn" (click)="saveUserChanges()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        <button class="cancel-btn" (click)="closeEditModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      </div>
    </div>
  </div>

  <!-- Pending Claims Section -->
  <div class="content-section" *ngIf="pendingClaims.length > 0">
    <div class="section-header">
      <i class="fas fa-clock"></i>
      <h3>‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ú‡∏π‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</h3>
    </div>
    <div class="content-list">
      <div class="list-item" *ngFor="let c of pendingClaims">
        <div class="item-info">
          <div class="item-name">Device ID: {{ c.deviceId }}</div>
          <div class="item-detail">‡∏ú‡∏π‡πâ‡∏Ç‡∏≠: {{ c.username }}</div>
          <div class="item-detail">‡πÄ‡∏ß‡∏•‡∏≤: {{ c.ts | date:'short' }}</div>
        </div>
        <div class="item-actions">
          <button class="btn btn-edit" (click)="approveClaim(c.deviceId)">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
          <button class="btn btn-delete" (click)="rejectClaim(c.deviceId)">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Devices Section -->
  <div class="content-section" *ngIf="showDevicesList">
    <div class="section-header">
      <i class="fas fa-microchip"></i>
      <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
      <span class="user-count">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: {{ devices.length }} ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</span>
    </div>
    <div class="content-list">
      <div class="list-item" *ngFor="let device of devices">
        <div class="item-info">
          <div class="item-name">{{ device.display_name || device.name || 'Device ' + (device.id || device.deviceid) }}</div>
          <div class="item-detail">ID: {{ device.id || device.deviceid }}</div>
          <div class="item-detail" *ngIf="device.user_id || device.userid">
            ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: {{ getDeviceUserName(device.user_id || device.userid) }}
          </div>
          <div class="item-detail">
            ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: 
            <span [ngClass]="device.status === 'active' ? 'status-active' : 'status-inactive'">
              {{ device.status || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}
            </span>
          </div>
          <div class="item-detail" *ngIf="device.created_at">
            ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: {{ formatDate(device.created_at) }}
          </div>
        </div>
        <div class="item-actions">
          <button class="btn btn-view" (click)="viewDevice(device)">‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
          <button class="btn btn-delete" (click)="deleteDevice(device.id || device.deviceid)">‡∏•‡∏ö</button>
        </div>
      </div>
      <div class="no-data" *ngIf="devices.length === 0">
        <i class="fas fa-microchip"></i>
        <p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</p>
      </div>
    </div>
  </div>

  <!-- Add Device Section -->
  <div class="content-section">
    <div class="section-header">
      <i class="fas fa-plus-circle"></i>
      <h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏´‡∏°‡πà</h3>
    </div>
    <div class="form-inputs">
      <input type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå" [(ngModel)]="newDeviceName">
      <div class="user-input-box">
        <input type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" [(ngModel)]="newDeviceUser" (input)="onUserInput()">
        <ul class="suggest-list" *ngIf="filteredUsers.length > 0">
          <li *ngFor="let u of filteredUsers" (click)="selectUser(u.username)">
            {{ u.username }}
          </li>
        </ul>
      </div>
      <button class="save-btn" (click)="addDevice()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</button>
    </div>
  </div>
</div>
