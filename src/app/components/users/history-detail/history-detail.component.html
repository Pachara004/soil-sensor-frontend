<div class="detail-container">
  <div class="card">
    <!-- ปุ่มย้อนกลับ -->
    <div class="back" (click)="goBack()">
      <i class="fas fa-arrow-left"></i>
    </div>

    <!-- ไอคอนบนสุด -->
    <img src="https://cdn.iconscout.com/icon/premium/png-256-thumb/soil-sensor-4449978-3688706.png" class="chip-icon"
      alt="chip" />

    <!-- Header ด้านบน -->
    <div class="header">
      <div class="user-id">User : {{ username }}</div>
      <div class="user-icon" (click)="goToProfile()" style="cursor: pointer;">
        <img src="https://www.iconpacks.net/icons/2/free-user-icon-3296-thumb.png" alt="user" />
        <div class="text">ข้อมูลผู้ใช้</div>
      </div>
    </div>

    <!-- ข้อมูลอุปกรณ์และวันที่ -->
    <div class="measurement-info-section">
      <div class="section-title">รายละเอียดการวัด</div>

      <div class="info-grid">
        <div class="info-item">
          <span class="info-label">อุปกรณ์:</span>
          <span class="info-value">{{ deviceId }}</span>
        </div>

        <div class="info-item">
          <span class="info-label">วันที่:</span>
          <span class="info-value">{{ measureDate }}</span>
        </div>

        <div class="info-item">
          <span class="info-label">เวลา:</span>
          <span class="info-value">{{ measureTime }}</span>
        </div>

        <div class="info-item">
          <span class="info-label">Areas ID:</span>
          <span class="info-value">{{ areasid || 'ไม่ระบุ' }}</span>
        </div>

        <div class="info-item full-width">
          <span class="info-label">สถานที่:</span>
          <span class="info-value">{{ getDisplayLocation() }}</span>
        </div>
      </div>
    </div>

    <!-- แผนที่ -->
    <div class="map-section" *ngIf="mapUrl">
      <div class="section-title">ตำแหน่งที่วัด</div>
      <div class="map-container">
        <iframe [src]="mapUrl | safe" width="100%" height="250" frameborder="0" style="border-radius: 12px;">
        </iframe>
      </div>
    </div>

    <!-- ผลการวัด -->
    <div class="results-section">
      <div class="section-title">ผลการวัด</div>

      <div class="sensors-grid">
        <div class="sensor-card temperature">
          <div class="sensor-icon">
            <img src="https://cdn-icons-png.flaticon.com/512/3534/3534501.png" alt="temperature" />
          </div>
          <div class="sensor-content">
            <div class="sensor-value">{{ temperature }}</div>
            <div class="sensor-unit">°C</div>
            <div class="sensor-label">อุณหภูมิ</div>
            <div class="sensor-status" [ngClass]="getTemperatureStatus()">
              {{ getTemperatureStatusText() }}
            </div>
          </div>
        </div>

        <div class="sensor-card moisture">
          <div class="sensor-icon">
            <img src="https://cdn-icons-png.flaticon.com/512/6393/6393411.png" alt="moisture" />
          </div>
          <div class="sensor-content">
            <div class="sensor-value">{{ moisture }}</div>
            <div class="sensor-unit">%</div>
            <div class="sensor-label">ความชื้น</div>
            <div class="sensor-status" [ngClass]="getMoistureStatus()">
              {{ getMoistureStatusText() }}
            </div>
          </div>
        </div>

        <div class="sensor-card nitrogen">
          <div class="sensor-icon">
            <img src="https://cdn-icons-png.flaticon.com/512/6678/6678672.png" alt="nitrogen" />
          </div>
          <div class="sensor-content">
            <div class="sensor-value">{{ nitrogen }}</div>
            <div class="sensor-unit">mg/kg</div>
            <div class="sensor-label">ไนโตรเจน (N)</div>
            <div class="sensor-status" [ngClass]="getNitrogenStatus()">
              {{ getNitrogenStatusText() }}
            </div>
          </div>
        </div>

        <div class="sensor-card phosphorus">
          <div class="sensor-icon">
            <img src="https://cdn-icons-png.flaticon.com/512/6678/6678656.png" alt="phosphorus" />
          </div>
          <div class="sensor-content">
            <div class="sensor-value">{{ phosphorus }}</div>
            <div class="sensor-unit">mg/kg</div>
            <div class="sensor-label">ฟอสฟอรัส (P)</div>
            <div class="sensor-status" [ngClass]="getPhosphorusStatus()">
              {{ getPhosphorusStatusText() }}
            </div>
          </div>
        </div>

        <div class="sensor-card potassium">
          <div class="sensor-icon">
            <img src="https://cdn-icons-png.flaticon.com/512/6678/6678660.png" alt="potassium" />
          </div>
          <div class="sensor-content">
            <div class="sensor-value">{{ potassium }}</div>
            <div class="sensor-unit">mg/kg</div>
            <div class="sensor-label">โพแทสเซียม (K)</div>
            <div class="sensor-status" [ngClass]="getPotassiumStatus()">
              {{ getPotassiumStatusText() }}
            </div>
          </div>
        </div>

        <div class="sensor-card ph">
          <div class="sensor-icon">
            <img src="https://cdn-icons-png.flaticon.com/512/9162/9162345.png" alt="ph" />
          </div>
          <div class="sensor-content">
            <div class="sensor-value">{{ ph }}</div>
            <div class="sensor-unit">pH</div>
            <div class="sensor-label">ค่าความเป็นกรด-ด่าง</div>
            <div class="sensor-status" [ngClass]="getPhStatus()">
              {{ getPhStatusText() }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- รายการจุดวัดทั้งหมด -->
    <div class="measurement-points-section" *ngIf="measurementPoints.length > 0">
      <div class="section-title">
        <i class="fas fa-map-marker-alt"></i>
        จุดวัดทั้งหมด ({{ measurementPoints.length }} จุด)
      </div>

      <div class="points-grid" *ngIf="!loading">
        <div class="point-card" *ngFor="let point of measurementPoints; let i = index"
          (click)="showMeasurementPointDetail(point)">
          <div class="point-header">
            <div class="point-number">จุดที่ {{ point.measurementPoint }}</div>
            <div class="point-date">{{ getPointDate(point) }}</div>
          </div>

          <div class="point-id">
            <i class="fas fa-hashtag"></i>
            Measurement ID: {{ point.id }}
          </div>

          <div class="point-location">
            <i class="fas fa-location-dot"></i>
            {{ getPointDisplayLocation(point) }}
          </div>

          <div class="point-measurements">
            <div class="measurement-item">
              <span class="measurement-label">อุณหภูมิ:</span>
              <span class="measurement-value">{{ point.temperature }}°C</span>
            </div>
            <div class="measurement-item">
              <span class="measurement-label">ความชื้น:</span>
              <span class="measurement-value">{{ point.moisture }}%</span>
            </div>
            <div class="measurement-item">
              <span class="measurement-label">pH:</span>
              <span class="measurement-value">{{ point.ph }}</span>
            </div>
          </div>

          <div class="point-actions">
            <button class="view-detail-btn">
              <i class="fas fa-eye"></i>
              ดูรายละเอียด
            </button>
          </div>
        </div>
      </div>

      <div class="loading-spinner" *ngIf="loading">
        <i class="fas fa-spinner fa-spin"></i>
        <span>กำลังโหลดข้อมูลจุดวัด...</span>
      </div>
    </div>

    <!-- สรุปผลและคำแนะนำ -->
    <div class="summary-section">
      <div class="section-title">สรุปผลการวัด</div>
      <div class="summary-content">
        <div class="overall-status" [ngClass]="getOverallStatus()">
          <div class="status-icon">
            <i [class]="getOverallStatusIcon()"></i>
          </div>
          <div class="status-text">
            <div class="status-title">{{ getOverallStatusTitle() }}</div>
            <div class="status-description">{{ getOverallStatusDescription() }}</div>
          </div>
        </div>

        <div class="recommendations" *ngIf="getRecommendations().length > 0">
          <h4>คำแนะนำ:</h4>
          <ul>
            <li *ngFor="let recommendation of getRecommendations()">
              {{ recommendation }}
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- ปุ่มดาวน์โหลดรายงาน -->
    <div class="action-section">
      <button class="download-btn" (click)="downloadReport()">
        <i class="fas fa-download"></i>
        ดาวน์โหลดรายงาน
      </button>
      <button class="share-btn" (click)="shareReport()">
        <i class="fas fa-share-alt"></i>
        แชร์ผลการวัด
      </button>
    </div>

    <!-- ติดต่อ Admin -->
    <div class="admin" (click)="goToContactAdmin()">
      <img src="https://cdn-icons-png.flaticon.com/512/9703/9703596.png" alt="admin" />
      <div>ติดต่อ Admin</div>
    </div>
  </div>

  <!-- Modal สำหรับแสดงรายละเอียดจุดวัด -->
  <div class="point-detail-modal" *ngIf="showPointDetail && selectedPoint" (click)="closePointDetail()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>
          <i class="fas fa-map-marker-alt"></i>
          รายละเอียดจุดที่ {{ selectedPoint.measurementPoint }}
        </h3>
        <button class="close-btn" (click)="closePointDetail()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        <!-- ข้อมูลตำแหน่ง -->
        <div class="detail-section">
          <div class="detail-title">ตำแหน่ง</div>
          <div class="detail-content">
            <div class="detail-item">
              <span class="detail-label">Measurement ID:</span>
              <span class="detail-value">{{ selectedPoint.id }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Areas ID:</span>
              <span class="detail-value">{{ selectedPoint.areasid }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">พิกัด:</span>
              <span class="detail-value">{{ selectedPoint.lat.toFixed(6) }}, {{ selectedPoint.lng.toFixed(6) }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">วันที่:</span>
              <span class="detail-value">{{ getPointDate(selectedPoint) }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">เวลา:</span>
              <span class="detail-value">{{ getPointTime(selectedPoint) }}</span>
            </div>
          </div>
        </div>

        <!-- ข้อมูลการวัด -->
        <div class="detail-section">
          <div class="detail-title">ผลการวัด</div>
          <div class="measurements-grid">
            <div class="measurement-card temperature">
              <div class="measurement-icon">
                <img src="https://cdn-icons-png.flaticon.com/512/3534/3534501.png" alt="temperature" />
              </div>
              <div class="measurement-info">
                <div class="measurement-value">{{ selectedPoint.temperature }}</div>
                <div class="measurement-unit">°C</div>
                <div class="measurement-label">อุณหภูมิ</div>
              </div>
            </div>

            <div class="measurement-card moisture">
              <div class="measurement-icon">
                <img src="https://cdn-icons-png.flaticon.com/512/6393/6393411.png" alt="moisture" />
              </div>
              <div class="measurement-info">
                <div class="measurement-value">{{ selectedPoint.moisture }}</div>
                <div class="measurement-unit">%</div>
                <div class="measurement-label">ความชื้น</div>
              </div>
            </div>

            <div class="measurement-card nitrogen">
              <div class="measurement-icon">
                <img src="https://cdn-icons-png.flaticon.com/512/6678/6678672.png" alt="nitrogen" />
              </div>
              <div class="measurement-info">
                <div class="measurement-value">{{ selectedPoint.nitrogen }}</div>
                <div class="measurement-unit">mg/kg</div>
                <div class="measurement-label">ไนโตรเจน</div>
              </div>
            </div>

            <div class="measurement-card phosphorus">
              <div class="measurement-icon">
                <img src="https://cdn-icons-png.flaticon.com/512/6678/6678656.png" alt="phosphorus" />
              </div>
              <div class="measurement-info">
                <div class="measurement-value">{{ selectedPoint.phosphorus }}</div>
                <div class="measurement-unit">mg/kg</div>
                <div class="measurement-label">ฟอสฟอรัส</div>
              </div>
            </div>

            <div class="measurement-card potassium">
              <div class="measurement-icon">
                <img src="https://cdn-icons-png.flaticon.com/512/6678/6678660.png" alt="potassium" />
              </div>
              <div class="measurement-info">
                <div class="measurement-value">{{ selectedPoint.potassium }}</div>
                <div class="measurement-unit">mg/kg</div>
                <div class="measurement-label">โพแทสเซียม</div>
              </div>
            </div>

            <div class="measurement-card ph">
              <div class="measurement-icon">
                <img src="https://cdn-icons-png.flaticon.com/512/9162/9162345.png" alt="ph" />
              </div>
              <div class="measurement-info">
                <div class="measurement-value">{{ selectedPoint.ph }}</div>
                <div class="measurement-unit">pH</div>
                <div class="measurement-label">ความเป็นกรด-ด่าง</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-secondary" (click)="closePointDetail()">
          <i class="fas fa-times"></i>
          ปิด
        </button>
      </div>
    </div>
  </div>
</div>