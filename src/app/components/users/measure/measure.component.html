<div class="measure-container">
  <div class="card">
    <i class="fas fa-arrow-left back" (click)="goBack()"></i>

    <div class="header">
      <img src="https://cdn.iconscout.com/icon/premium/png-256-thumb/soil-sensor-4449978-3688706.png" class="icon" alt="Sensor Icon" />
      <div class="user-id">User : {{ username }}</div>
    </div>

    <h2 class="title">Customize your own NPK</h2>

    <div class="device-id">
      <span class="label-orange">‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå :  </span> {{ deviceId }}
    </div>

    <button class="save-btn" (click)="saveMeasurement()" [disabled]="isLoading || !bounds">
      <span *ngIf="!isLoading">‡∏ß‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤</span>
      <span *ngIf="isLoading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...</span>
    </button>

    <div class="grid">
      <div class="sensor-box">
        <img src="https://cdn-icons-png.flaticon.com/512/4850/4850456.png" class="sensor-icon" alt="Temperature Icon" />
        <span class="value">{{ temperature }}</span>
        <span class="unit">¬∞C</span>
        <p class="label">Temperature</p>
      </div>
      <div class="sensor-box">
        <img src="https://cdn-icons-png.flaticon.com/512/4148/4148460.png" class="sensor-icon" alt="Moisture Icon" />
        <span class="value">{{ moisture }}</span>
        <span class="unit">%</span>
        <p class="label">Moisture</p>
      </div>
      <div class="sensor-box">
        <img src="https://cdn-icons-png.flaticon.com/512/6678/6678672.png" class="sensor-icon" alt="Nitrogen Icon" />
        <span class="value">{{ nitrogen }}</span>
        <span class="unit">mg/kg</span>
        <p class="label">Nitrogen</p>
      </div>
      <div class="sensor-box">
        <img src="https://cdn-icons-png.flaticon.com/512/6678/6678656.png" class="sensor-icon" alt="Phosphorus Icon" />
        <span class="value">{{ phosphorus }}</span>
        <span class="unit">mg/kg</span>
        <p class="label">Phosphorus</p>
      </div>
      <div class="sensor-box">
        <img src="https://cdn-icons-png.flaticon.com/512/6678/6678660.png" class="sensor-icon" alt="Potassium Icon" />
        <span class="value">{{ potassium }}</span>
        <span class="unit">mg/kg</span>
        <p class="label">Potassium</p>
      </div>
      <div class="sensor-box">
        <img src="https://cdn-icons-png.flaticon.com/512/4236/4236740.png" class="sensor-icon" alt="PH Icon" />
        <span class="value">{{ ph }}</span>
        <span class="unit">%</span>
        <p class="label">Potential of Hydrogen (PH)</p>
      </div>
    </div>

    <div class="location-box">
      <textarea [(ngModel)]="locationDetail" placeholder="‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á..." readonly></textarea>
    </div>

    <div class="map-container">
      <div #mapContainer class="map" style="width: 100%; height: 300px;"></div>
    </div>

    <div class="admin" (click)="goToContactAdmin()">
      <img src="https://cdn-icons-png.flaticon.com/512/2914/2914688.png" alt="Admin Icon" />
      ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ Admin
    </div>
    <button class="history-btn" (click)="goToHistory()">‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î</button>

    <!-- Popup ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 4 ‡∏à‡∏∏‡∏î -->
    <div class="popup-overlay" *ngIf="showPopup" (click)="closePopup()">
      <div class="popup-content" (click)="stopPropagation($event)">
        <h3>‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏î‡∏î‡∏¥‡∏ô</h3>
        <p>‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏á‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 3 ‡∏à‡∏∏‡∏î)</p>
        <p>‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß: <strong>{{ points.length }}</strong> ‡∏à‡∏∏‡∏î</p>
        
        <div #mapPopupContainer class="map-popup" style="width: 100%; height: 300px;"></div>
        
        <div class="popup-buttons">
          <button class="btn-test" (click)="testAddPoint()" style="background: green; color: white; margin: 5px;">
            üß™ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î‡∏ó‡∏î‡∏™‡∏≠‡∏ö
          </button>
          <button class="btn-secondary" (click)="clearMarks()" [disabled]="points.length === 0">
            ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏à‡∏∏‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
          </button>
          <button class="btn-primary" (click)="confirmArea()" [disabled]="points.length < 3">
            ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ({{ points.length }} ‡∏à‡∏∏‡∏î)
          </button>
          <button class="btn-cancel" (click)="closePopup()">
            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
          </button>
        </div>
      </div>
    </div>
    
  </div>
</div>