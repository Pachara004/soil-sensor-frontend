<div class="container">
  <!-- Header -->
  <div class="header">
    <div class="logo">
      <i class="fas fa-seedling"></i>
      <span>Soil Monitor</span>
    </div>
    <button (click)="logout()" class="logout-btn">
      <i class="fas fa-sign-out-alt"></i>
      ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
    </button>
  </div>

  <!-- User Info Section -->
  <div class="user-info">
    <div class="user-details">
      <div class="user-item">
        <i class="fas fa-user"></i>
        <span class="label">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:</span>
        <span class="value">{{ userName || userEmail || userID }}</span>
      </div>
      <div class="user-item">
        <i class="fas fa-clock"></i>
        <span class="label">‡πÄ‡∏ß‡∏•‡∏≤:</span>
        <span class="value">{{ currentTime }}</span>
      </div>
    </div>
  </div>

  <!-- Device Section -->
  <div class="device-section">
    <div class="device-header">
      <i class="fas fa-microchip"></i>
      <h3>‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h3>
    </div>

    <div class="device-selector">
      <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (‡∏Å‡∏£‡∏ì‡∏µ > 1 ‡∏ä‡∏¥‡πâ‡∏ô) -->
      <select class="device-select" *ngIf="devices.length > 1" [(ngModel)]="selectedDeviceId"
        (ngModelChange)="onDeviceChange()" [disabled]="isLoading" aria-label="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå">
        <option value="" disabled>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå --</option>
        <option *ngFor="let device of devices" [value]="device.deviceid">
          {{ device.device_name || device.deviceid }}
          <span *ngIf="device.sensor_status === 'online'">üü¢</span>
          <span *ngIf="device.sensor_status !== 'online'">üî¥</span>
        </option>
      </select>

      <!-- Loading indicator ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå -->
      <div class="loading-indicator" *ngIf="isLoading">
        <i class="fas fa-spinner fa-spin"></i>
        <span>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå...</span>
      </div>

      <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå -->
      <div class="device-name" *ngIf="devices.length === 1">
        {{ devices[0].device_name || devices[0].deviceid }}
      </div>
      <div class="device-name" *ngIf="devices.length === 0">
        ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
      </div>
    </div>
    
    <!-- ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Sensor ‡∏à‡∏≤‡∏Å Firebase -->
    <div class="device-status-card" *ngIf="selectedDevice && selectedDevice.firebase_synced">
      <div class="status-header">
        <i class="fas fa-satellite-dish"></i>
        <h4>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå</h4>
        <span class="badge" [class.online]="selectedDevice.sensor_status === 'online'"
                           [class.offline]="selectedDevice.sensor_status !== 'online'">
          {{ selectedDevice.sensor_status === 'online' ? 'üü¢ ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå' : 'üî¥ ‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå' }}
        </span>
      </div>
      
      <div class="status-details">
        <div class="status-item">
          <span class="label">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå:</span>
          <span class="value">{{ selectedDevice.device_name }}</span>
        </div>
        <div class="status-item">
          <span class="label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå:</span>
          <span class="value" [class.text-success]="selectedDevice.sensor_status === 'online'"
                             [class.text-danger]="selectedDevice.sensor_status !== 'online'">
            {{ selectedDevice.sensor_status === 'online' ? '‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå' : '‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå' }}
          </span>
        </div>
        <div class="status-item" *ngIf="selectedDevice.firebase_data?.temperature">
          <span class="label">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:</span>
          <span class="value">{{ selectedDevice.firebase_data.temperature }}¬∞C</span>
        </div>
        <div class="status-item" *ngIf="selectedDevice.firebase_data?.moisture">
          <span class="label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:</span>
          <span class="value">{{ selectedDevice.firebase_data.moisture }}%</span>
        </div>
      </div>
      
      <div class="sync-info">
        <i class="fas fa-check-circle"></i>
        <small>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firebase Realtime Database</small>
      </div>
    </div>
    
    <!-- ‚ö†Ô∏è ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ô Firebase -->
    <div class="device-warning" *ngIf="selectedDevice && !selectedDevice.firebase_synced">
      <i class="fas fa-exclamation-triangle"></i>
      <p>‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Firebase</p>
      <small>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</small>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="actions-grid">
    <div class="action-card primary" (click)="goToMeasure()">
      <i class="fas fa-play-circle"></i>
      <h4>‡∏ß‡∏±‡∏î‡∏Ñ‡πà‡∏≤</h4>
      <p>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÉ‡∏ô‡∏î‡∏¥‡∏ô</p>
    </div>

    <div class="action-card secondary" (click)="goToHistory()">
      <i class="fas fa-history"></i>
      <h4>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î‡∏Ñ‡πà‡∏≤</h4>
      <p>‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏î‡πÑ‡∏î‡πâ</p>
    </div>

    <div class="action-card info" (click)="goToProfile()">
      <i class="fas fa-user-circle"></i>
      <h4>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h4>
      <p>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</p>
    </div>

    <div class="action-card success" (click)="goToContactAdmin()">
      <i class="fas fa-headset"></i>
      <h4>‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ Admin</h4>
      <p>‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p>
    </div>
  </div>

  <!-- Add Device Section -->
  <div class="add-device">
    <h3>
      <i class="fas fa-plus-circle"></i>
      ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏´‡∏°‡πà
    </h3>

    <div class="device-help">
      <p><strong>üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong></p>
      <ul>
        <li>‡∏û‡∏¥‡∏°‡∏û‡πå <strong>"test"</strong> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏î‡∏™‡∏≠‡∏ö ESP32-soil-test</li>
        <li>‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏à‡∏£‡∏¥‡∏á: <strong>esp32-soil-001</strong> ‡∏ñ‡∏∂‡∏á <strong>esp32-soil-999</strong></li>
        <li>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: esp32-soil-001, esp32-soil-123, esp32-soil-999</li>
        <li>‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏à‡∏∞‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô online ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</li>
      </ul>
    </div>

    <div class="device-input-group">
      <input class="claim-input" [class.error]="deviceValidationError" type="text" [(ngModel)]="claimDeviceId"
        (input)="validateDeviceInput()" (keyup.enter)="addNewDevice()"
        placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå ‡πÄ‡∏ä‡πà‡∏ô test ‡∏´‡∏£‡∏∑‡∏≠ esp32-soil-001" aria-label="Device ID">

      <div class="device-validation-message" *ngIf="deviceValidationMessage">
        <i class="fas fa-exclamation-triangle"></i>
        {{ deviceValidationMessage }}
      </div>

      <button class="claim-btn" [disabled]="requestingClaim || !claimDeviceId.trim() || deviceValidationError"
        (click)="addNewDevice()" aria-label="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå">
        <i class="fas fa-plus" *ngIf="!requestingClaim"></i>
        <span class="spinner" *ngIf="requestingClaim" aria-hidden="true"></span>
        <span *ngIf="!requestingClaim">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</span>
      </button>
    </div>

    <div class="claim-help">
      ‡∏û‡∏¥‡∏°‡∏û‡πå Device ID ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î Enter ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    </div>

    <div class="claim-status" *ngIf="lastClaimMessage" [ngClass]="lastClaimType">
      <div class="status-dot"></div>
      {{ lastClaimMessage }}
    </div>
  </div>

  <!-- Notification Popup -->
  <div class="notification-overlay" *ngIf="showNotification" (click)="closeNotification()">
    <div class="notification-popup" (click)="$event.stopPropagation()">
      <div class="notification-header" [ngClass]="notificationType">
        <i class="notification-icon" [ngClass]="getNotificationIcon()"></i>
        <h3 class="notification-title">{{ notificationTitle }}</h3>
        <button class="close-btn" (click)="closeNotification()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="notification-body">
        <p class="notification-message">{{ notificationMessage }}</p>
        <div class="notification-actions" *ngIf="showNotificationActions">
          <button class="btn-secondary" (click)="closeNotification()">‡∏õ‡∏¥‡∏î</button>
          <button class="btn-primary" (click)="onNotificationConfirm()" *ngIf="notificationConfirmText">
            {{ notificationConfirmText }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚úÖ Persistent Notification Modal -->
  <div class="persistent-notification-overlay" *ngIf="showPersistentNotification" (click)="dismissPersistentNotification()">
    <div class="persistent-notification-modal" (click)="$event.stopPropagation()">
      <div class="notification-header">
        <div class="notification-icon">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="notification-title">
          {{ currentPersistentNotification?.title || '‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô' }}
        </div>
        <button class="close-btn" (click)="dismissPersistentNotification()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="notification-content">
        <div class="notification-message">
          {{ currentPersistentNotification?.message || '‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà' }}
        </div>
        
        <div class="notification-details" *ngIf="currentPersistentNotification">
          <div class="detail-item">
            <i class="fas fa-user-shield"></i>
            <span>‡∏à‡∏≤‡∏Å: {{ currentPersistentNotification.adminName || 'Admin' }}</span>
          </div>
          <div class="detail-item">
            <i class="fas fa-clock"></i>
            <span>‡πÄ‡∏ß‡∏•‡∏≤: {{ formatNotificationTime(currentPersistentNotification.timestamp) }}</span>
          </div>
        </div>
      </div>
      
      <div class="notification-actions">
        <button class="acknowledge-btn" (click)="acknowledgeNotification(currentPersistentNotification?.id)">
          <i class="fas fa-check"></i>
          ‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö
        </button>
        <button class="dismiss-btn" (click)="dismissPersistentNotification()">
          <i class="fas fa-times"></i>
          ‡∏õ‡∏¥‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
        </button>
      </div>
    </div>
  </div>
</div>